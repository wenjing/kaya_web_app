<script src="http://maps.google.com/maps?file=api&amp;v=2&amp;key=<%= ENV['GOOGLE_MAP_KEY']||'ABQIAAAAnfs7bKE82qgb3Zc2YyS-oBT2yXp_ZAY8_ufC3CFXhHIE1NvwkxSySz_REpPq-4WZA27OwgbtyR3VcA' %>
        type="text/javascript"></script>
<script type="text/javascript">

function initialize() {
  if (GBrowserIsCompatible()) {
    var map = new GMap2(document.getElementById("map_canvas"));
    map.setCenter(new GLatLng(<%= center_ll =%>), <%= zoom %>);
    map.addControl(new GSmallMapControl());
    map.addControl(new GMapTypeControl());

    //var bounds = map.getBounds();
    //var southWest = bounds.getSouthWest();
    //var northEast = bounds.getNorthEast();
    //var lngSpan = northEast.lng() - southWest.lng();
    //var latSpan = northEast.lat() - southWest.lat();
    var markers = new Array(<%= meets.size %>);
    var point;
    var marker_id = 0;
    <% meets.each_with_index {|meet, nn| %>
      <% next if meet.lat_lng.blank? %>
      var point = new GLatLng(<%= meet.lat_lng %>)
      markers[<%=nn%>] = new GMarker(point)
      map.addOverlay(markers[<%=nn%>])
      GEvent.addListener(markers[<%=nn%>], "click", function() {
        //map.panTo(markers[<%=nn%>].getLatLng());
        markers[<%=nn%>].openInfoWindowHtml('<%= meet_marker meet %>');
      });
    <% } %>
    var map_reset = document.getElementById("map_canvas_reset");
    map_reset.addEventListener("click", function() {
      marker_id = 0;
      map.setCenter(new GLatLng(<%= center_ll =%>), <%= zoom %>);
    });
    var map_center = document.getElementById("map_canvas_center");
    map_center.addEventListener("click", function() {
      map.setCenter(new GLatLng(<%= center_ll =%>), map.getZoom());
    });
    var map_next = document.getElementById("map_canvas_next");
    map_next.addEventListener("click", function() {
      marker_id += 1;
      if (marker_id > markers.length) {
        marker_id = 0
      }
      GEvent.trigger(markers[marker_id], 'click')
    });
    var map_prev = document.getElementById("map_canvas_prev");
    map_prev.addEventListener("click", function() {
      marker_id -= 1;
      if (marker_id < 0) {
        marker_id = markers.length-1
      }
      GEvent.trigger(markers[marker_id], 'click')
    });
  }
}

</script>

<div class="meet_map_content", onload="initialize()" onunload="GUnload()">
  <div id="map_canvas" style="width: 670px; height: 500px"></div>
  <%= submit_tag "Prev", :id => "map_canvas_prev", :disabled => meets.size <= 1 %>
  <%= submit_tag "Next", :id => "map_canvas_next", :disabled => meets.size <= 1 %>
  <%= submit_tag "Center", :id => "map_canvas_center", :disabled => meets.size != 1 %>
  <%= submit_tag "Reset", :id => "map_canvas_reset", :disabled => meets.empty? %>
</div> 
